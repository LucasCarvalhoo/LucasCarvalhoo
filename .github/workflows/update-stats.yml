name: Update GitHub Profile Stats

on:
  schedule:
    - cron: "0 */6 * * *" # a cada 6 horas
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
    
      - name: Garantir pasta de sa√≠da
        run: mkdir -p assets

      # üìä Linguagens (lowlighter/metrics)
      - name: Generate GitHub Metrics (linguagens usadas)
        uses: lowlighter/metrics@latest
        with:
          filename: assets/metrics-stack.svg
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          base: "" # sem card padr√£o
          plugin_languages: yes
          plugin_languages_ignored: html, css, python
          plugin_languages_details: percentage
          plugin_languages_limit: 8
          plugin_languages_sections: most-used
          plugin_languages_analysis_timeout: 15

      # ‚≠ê Estat√≠sticas gerais (Readme Stats)
      - name: Download GitHub Stats Card
        run: |
          curl -H "Authorization: token ${{ secrets.PERSONAL_ACCESS_TOKEN }}" \
            -o assets/stats.svg \
            "https://github-readme-stats-sigma-five.vercel.app/api?username=LucasCarvalhoo&show_icons=true&theme=dracula&include_all_commits=true&count_private=true&hide_border=true"

      # üì§ Commit e push
      - name: Commit e push
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add assets/metrics-stack.svg assets/stats.svg
          git diff --staged --quiet || (git commit -m "üìä Atualizar m√©tricas do perfil" && git push)
