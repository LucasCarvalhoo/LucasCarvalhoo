name: Update GitHub Profile Stats

on:
  schedule:
    - cron: "0 */6 * * *"
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
    
      - name: Garantir pasta de saÃ­da
        run: | 
          mkdir -p assets

          curl -H "Authorization: token ${{ secrets.PERSONAL_ACCESS_TOKEN }}" \
            -o assets/stats.svg \
            "https://github-readme-stats-sigma-five.vercel.app/api?username=LucasCarvalhoo&show_icons=true&theme=dracula&include_all_commits=true&count_private=true&hide_border=true"


      - name: Substituir no README
        run: |
          # Substitui os links por arquivos locais (commitados no repo)
          sed -i 's#https://github-readme-stats\.vercel\.app/api?.*#assets/stats.svg" />#' README.md

      - name: Generate GitHub Metrics (inclui privados)
        uses: lowlighter/metrics@latest
        with:
          filename: assets/metrics-stack.svg
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          base: ""
          plugin_languages: yes
          plugin_languages_ignored: html, css
          plugin_languages_details: percentage
          plugin_languages_limit: 8
          plugin_languages_sections: most-used
          plugin_languages_analysis_timeout: 15
